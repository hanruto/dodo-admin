(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1075:function(module,exports,__webpack_require__){"use strict";(function(module){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _getPrototypeOf=__webpack_require__(89),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=__webpack_require__(21),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=__webpack_require__(22),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=__webpack_require__(28),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=__webpack_require__(29),_inherits3=_interopRequireDefault(_inherits2),_react=__webpack_require__(2),_react2=_interopRequireDefault(_react),_braftEditor=__webpack_require__(900),_braftEditor2=_interopRequireDefault(_braftEditor),_codeHighlighter=__webpack_require__(1171),_codeHighlighter2=_interopRequireDefault(_codeHighlighter),_tool=__webpack_require__(792);__webpack_require__(320),__webpack_require__(854);var _classnames=__webpack_require__(144),_classnames2=_interopRequireDefault(_classnames),enterModule;function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e},PRIMARY_COLOR="#368DF3",controls=["font-size","line-height","text-align","text-color","list-ul","list-ol","code","blockquote","headings","hr","media","emoji","link","remove-styles","undo","redo","fullscreen"];_braftEditor2.default.use((0,_codeHighlighter2.default)({includeEditors:["editor-with-code-highlighter"]}));var Editor=function(_React$Component){function Editor(){var e,t,a,o;(0,_classCallCheck3.default)(this,Editor);for(var r=arguments.length,l=Array(r),i=0;i<r;i++)l[i]=arguments[i];return t=a=(0,_possibleConstructorReturn3.default)(this,(e=Editor.__proto__||(0,_getPrototypeOf2.default)(Editor)).call.apply(e,[this].concat(l))),a.state={contentSize:"middle"},a.handleUploadImage=function(e){var t=e.file,a=e.success;if(t){var o=new FormData;o.append("file",t),_tool.hzhjNetwork.post("upload/xiaohan",o,{headers:{vf:"xiaohangogogo"}}).then((function(e){var t=e.data.data[0];a({url:t})}))}},a.handleToggleContentWidth=function(){var e="large"===a.state.contentSize?"middle":"large";a.setState({contentSize:e})},o=t,(0,_possibleConstructorReturn3.default)(a,o)}return(0,_inherits3.default)(Editor,_React$Component),(0,_createClass3.default)(Editor,[{key:"render",value:function(){var e=this.props,t=e.value,a=e.onChange,o=this.state.contentSize;return _react2.default.createElement("div",{className:(0,_classnames2.default)("editor-wrapper","large"!==o&&"editor-middle-width")},_react2.default.createElement(_braftEditor2.default,{value:t,controls:controls,colors:[PRIMARY_COLOR,"#fff","#666","#999"],onChange:a,textBackgroundColor:!1,media:{uploadFn:this.handleUploadImage},onSave:this.handleSaveInLocal,extendControls:[{key:"button",type:"button",title:"按照720px的宽度展示",className:"",text:"W",onClick:this.handleToggleContentWidth}]}))}},{key:"__reactstandin__regenerateByEval",value:function __reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}]),Editor}(_react2.default.Component),reactHotLoader,leaveModule;exports.default=Editor,reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&(reactHotLoader.register(PRIMARY_COLOR,"PRIMARY_COLOR","/Users/qm/project/dodo-admin/src/components/Editor.jsx"),reactHotLoader.register(controls,"controls","/Users/qm/project/dodo-admin/src/components/Editor.jsx"),reactHotLoader.register(Editor,"Editor","/Users/qm/project/dodo-admin/src/components/Editor.jsx")),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)}).call(this,__webpack_require__(23)(module))},775:function(module,exports,__webpack_require__){"use strict";(function(module){Object.defineProperty(exports,"__esModule",{value:!0});var _stringify=__webpack_require__(875),_stringify2=_interopRequireDefault(_stringify),_extends2=__webpack_require__(53),_extends3=_interopRequireDefault(_extends2),_getPrototypeOf=__webpack_require__(89),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=__webpack_require__(21),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=__webpack_require__(22),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=__webpack_require__(28),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=__webpack_require__(29),_inherits3=_interopRequireDefault(_inherits2),_class,_react=__webpack_require__(2),_react2=_interopRequireDefault(_react),_axios=__webpack_require__(314),_axios2=_interopRequireDefault(_axios),_reactRouterDom=__webpack_require__(103),_select=__webpack_require__(827),_select2=_interopRequireDefault(_select),_radio=__webpack_require__(815),_radio2=_interopRequireDefault(_radio),_modal=__webpack_require__(1071),_modal2=_interopRequireDefault(_modal),_button=__webpack_require__(799),_button2=_interopRequireDefault(_button),_dodoLogo=__webpack_require__(899),_dodoLogo2=_interopRequireDefault(_dodoLogo),_Editor=__webpack_require__(1075),_Editor2=_interopRequireDefault(_Editor),_braftEditor=__webpack_require__(900),_braftEditor2=_interopRequireDefault(_braftEditor),_needLogin=__webpack_require__(820),_needLogin2=_interopRequireDefault(_needLogin),enterModule;function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e},EditBlog=(0,_needLogin2.default)(_class=function(_React$Component){function EditBlog(){var e,t,a,o;(0,_classCallCheck3.default)(this,EditBlog);for(var r=arguments.length,l=Array(r),i=0;i<r;i++)l[i]=arguments[i];return t=a=(0,_possibleConstructorReturn3.default)(this,(e=EditBlog.__proto__||(0,_getPrototypeOf2.default)(EditBlog)).call.apply(e,[this].concat(l))),a.defaultBlog={type:1,tags:[],title:"",content:""},a.state={blog:a.defaultBlog,successModalVisible:!1,editorState:null,tagSelects:[]},a.initListener=function(){a.saveTimer=setInterval(a.handleSaveInLocal,1e4)},a.initialize=function(){if(a.blogId=a.props.match.params.blogId,a.mode=["add","restore"].includes(a.blogId)?a.blogId:"update",_axios2.default.get("/articles/tags").then((function(e){return a.setState({tagSelects:e})})),"add"===a.mode)a.setState({blog:a.defaultBlog});else if("restore"===a.mode){var e=localStorage.getItem("current-edit-blog"),t=e?JSON.parse(e):{},o=_braftEditor2.default.createEditorState(t.content);a.blogId=t._id,a.setState({blog:t,editorState:o})}else _axios2.default.get("/articles/"+a.blogId).then((function(e){e.tags=e.tags?e.tags.map((function(e){return e.value})):[],a.setState({blog:e,editorState:_braftEditor2.default.createEditorState(e.content)})}))},a.handleSubmit=function(e,t){e.preventDefault();var o=a.state,r=o.tagSelects,l=o.editorState,i=o.blog,n=(0,_extends3.default)({},i);n.content=l.toHTML(),n.tags=n.tags.map((function(e){return r.find((function(t){return t.value===e}))||{value:e}})),n.draft=!!t,"add"!==a.mode?_axios2.default.put("/articles/"+a.blogId,n).then((function(){return a.setState({successModalVisible:!0})})):_axios2.default.post("/articles",n).then((function(e){a.blogId=e._id,a.setState({successModalVisible:!0})}))},a.handleEdit=function(e,t){var o=a.state.blog;o[t]=e,a.setState({blog:o})},a.handleChangeTags=function(e){var t=a.state.blog;t.tags=e,a.setState({blog:t})},a.handleReturn=function(){a.props.history.push("/app/blogs")},a.handleCancel=function(){a.setState({successModalVisible:!1})},a.handleChangeEditorState=function(e){a.setState({editorState:e})},a.handleRenew=function(){a.setState({successModalVisible:!1}),"/app/blogs/add"!==a.props.location.pathname&&a.props.history.push("/app/blogs/add")},a.handleContinueEdit=function(){a.setState({successModalVisible:!1}),"/app/blogs/add"===a.props.location.pathname&&a.props.history.push("/app/blogs/"+a.blogId)},a.handlePreview=function(){a.props.history.push("/app/blogs/"+a.blogId+"/view")},a.handleSaveInLocal=function(){var e=a.state.blog;e.content=a.state.editorState.toHTML(),localStorage.setItem("current-edit-blog",(0,_stringify2.default)(e))},o=t,(0,_possibleConstructorReturn3.default)(a,o)}return(0,_inherits3.default)(EditBlog,_React$Component),(0,_createClass3.default)(EditBlog,[{key:"componentDidMount",value:function(){this.initialize(),this.initListener()}},{key:"componentDidUpdate",value:function(e){e.location.pathname!==this.props.location.pathname&&this.initialize()}},{key:"componentWillUnmount",value:function(){clearInterval(this.saveTimer)}},{key:"render",value:function(){var e=this,t=this.state.blog,a=t.type,o=t.title,r=t.tags,l=this.state,i=l.successModalVisible,n=l.editorState,d=this.state.tagSelects;return _react2.default.createElement("div",{className:"blog-edit-page"},_react2.default.createElement("div",{className:"blog-view-head"},_react2.default.createElement("div",{className:"blog-view-logo"},_react2.default.createElement("img",{src:_dodoLogo2.default,alt:""})),_react2.default.createElement("div",{className:"pull-right"},"add"!==this.mode&&_react2.default.createElement(_reactRouterDom.Link,{to:"/app/blogs/"+this.blogId+"/view"},_react2.default.createElement("span",{style:{marginRight:10}},"查看")),_react2.default.createElement(_reactRouterDom.Link,{to:"/app/blogs"},"返回"))),_react2.default.createElement("div",{className:"do-container"},_react2.default.createElement("form",{onSubmit:this.handleSubmit},_react2.default.createElement("div",{className:"do-group"},_react2.default.createElement(_radio2.default.Group,{onChange:function(t){return e.handleEdit(t.target.value,"type")},value:a},_react2.default.createElement(_radio2.default,{value:1},"技术博客"),_react2.default.createElement(_radio2.default,{value:2},"生活随笔"))),_react2.default.createElement("div",{className:"do-group"},_react2.default.createElement("input",{type:"text",value:o,onChange:function(t){return e.handleEdit(t.target.value,"title")},className:"do-input",placeholder:"这里写标题"})),_react2.default.createElement("div",{className:"do-group"},_react2.default.createElement(_select2.default,{mode:"tags",value:r,style:{width:"100%"},tokenSeparators:[","],onChange:this.handleChangeTags},d.map((function(e){return _react2.default.createElement(_select2.default.Option,{key:e._id,value:e.value},e.value)})))),_react2.default.createElement("div",{className:"do-group"},_react2.default.createElement(_Editor2.default,{value:n,onChange:this.handleChangeEditorState})),_react2.default.createElement("div",{className:"do-group"},_react2.default.createElement(_button2.default,{type:"primary",style:{width:120},onClick:this.handleSubmit},"提交"),_react2.default.createElement(_button2.default,{onClick:function(){return e.handleSaveInLocal()},style:{width:120,marginLeft:10}},"保存在本地"))),_react2.default.createElement(_modal2.default,{title:"提交成功",visible:i,onOk:this.handleOk,onCancel:this.handleReturn,footer:[_react2.default.createElement(_button2.default,{key:"view",type:"primary",onClick:this.handlePreview},"查看"),_react2.default.createElement(_button2.default,{key:"again",type:"primary",onClick:this.handleRenew},"再来一篇"),_react2.default.createElement(_button2.default,{key:"submit",onClick:this.handleContinueEdit},"继续编辑"),_react2.default.createElement(_button2.default,{key:"back",onClick:this.handleReturn},"返回列表")]},"add"===this.mode?"恭喜你完成了一篇巨作":"修改完成啦")))}},{key:"__reactstandin__regenerateByEval",value:function __reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}]),EditBlog}(_react2.default.Component))||_class,_default=EditBlog,reactHotLoader,leaveModule;exports.default=_default,reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&(reactHotLoader.register(EditBlog,"EditBlog","/Users/qm/project/dodo-admin/src/pages/EditBlog.jsx"),reactHotLoader.register(_default,"default","/Users/qm/project/dodo-admin/src/pages/EditBlog.jsx")),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)}).call(this,__webpack_require__(23)(module))}}]);